<script type="text/jsx">
  window.onload = function (e) {
    // Remove blur
    var mapWrapper = document.getElementsByClassName('world-map');
    mapWrapper[0].className = 'world-map';

    // Request cities
    // TODO
    $.getJSON('/foursquare/cities', function (cities) {
      cities = cities.cities || cities;

      for (var city in cities) {
        // TODO
      }
    })
  };

  var headerClass = 'alpha-header';

  var Avatar = React.createClass({
    render: function () {
      var classString = headerClass + '--avatar';

      return (
        <div className={classString}>
          <span>{this.props.msg}</span>
          <img src={this.props.src}/>
        </div>
      );
    }
  });

  var Menu = React.createClass({
    render: function () {
      var classString = headerClass + '--menu';

      return (
        <div className={classString}>
        </div>
      );
    }
  });

  var Account = React.createClass({
    getInitialState: function() {
      return {
        msg: 'Loading...',
        src: ''
      };
    },
    componentDidMount: function () {
      var size = '100x100'
      $.getJSON(this.props.endpoint, function (user) {
        user = user.user || user;
        console.log(user);

        if (this.isMounted()) {
          var msg = 'Welcome, ' + user.firstName + '!';
          var src = user.photo.prefix + size + user.photo.suffix
          this.setState({
            msg: msg,
            src: src
          });
        }
      }.bind(this));
    },
    render: function () {
      var classString = headerClass + '--account';

      return (
        <div className={classString}>
          <Avatar msg={this.state.msg} src={this.state.src} />
          <Menu />
        </div>
      );
    }
  });

  React.render(
    <Account endpoint="/foursquare/user" />,
    document.getElementById('header-wrapper-right')
  );
</script>

<header id="alpha-header" class="alpha-header">
  <div id="header-wrapper-right" class="alpha-header--right"></div>
</header>
